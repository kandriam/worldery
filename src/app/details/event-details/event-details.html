<section class="details-heading">
    <h2 class="event-title">{{ worldEvent?.name }}</h2>
    <button class="delete-button secondary" (click)="deleteEvent()">Delete Event</button>
</section>
<article>
    <form [formGroup]="applyForm" (submit)="submitApplication()">
        <section class="edit-event-form event-page-body">
            <div class="details-section primary-section horizontal-section">
                <div class="details-section secondary-section">
                    <label class="primary-label" for="event-title">Title</label>
                    <input id="event-title" type="text" formControlName="eventTitle" placeholder="Enter event name..." />
                </div>
                <div class="details-section secondary-section">
                    <label class="primary-label">Date</label>
                    <div class="date-selector">
                        <input id="event-year" type="number" formControlName="eventYear" placeholder="Year" min="1800" max="3000" />
                        <select id="event-month" formControlName="eventMonth">
                            <option value="">Month</option>
                            @for (month of months; track month) {
                                <option value="{{ month }}">{{ month }}</option>
                            }
                        </select>
                        <input id="event-day" type="number" formControlName="eventDay" placeholder="Day" min="1" max="31" />
                    </div>
                </div>
                <div class="details-section secondary-section">
                    <label class="primary-label">End Date (Optional)</label>
                    <div class="date-selector">
                        <input id="event-end-year" type="number" formControlName="eventEndYear" placeholder="Year" min="1800" max="3000" />
                        <select id="event-end-month" formControlName="eventEndMonth">
                            <option value="">Month</option>
                            @for (month of months; track month) {
                                <option value="{{ month }}">{{ month }}</option>
                            }
                        </select>
                        <input id="event-end-day" type="number" formControlName="eventEndDay" placeholder="Day" min="1" max="31" />
                    </div>
                </div>
            </div>
            
            <div class="details-section primary-section spanning-section">
                <div class="details-section secondary-section">
                    <label class="primary-label" for="event-description">Description</label>
                    <textarea id="event-description" class="medium-textarea" formControlName="eventDescription" placeholder="Describe what happened during this event..."></textarea>
                </div>
            </div>
            
            <div class="details-section primary-section spanning-section">
                <div class="details-section secondary-section">
                    <label class="primary-label" for="event-location">Location</label>
                    <div class="vertical-section">
                        @for(location of locationList; track location) {
                            <div class="form-field">
                                <input type="checkbox" id="location-checkbox-{{location.id}}" [value]="location.id" (change)="onLocationChange($event, location)" [checked]="isLocationInEvent(location.name)" />
                                <button class="linked-location" [routerLink]="['/location', location.id]" type="button">
                                    <label class="secondary-label">{{ location.name }}</label>
                                </button>
                            </div>
                        }
                    </div>
                </div>
                <div class="details-section secondary-section">
                    <label class="primary-label" for="event-stories">Stories</label>
                    <div class="vertical-section">
                        @for(story of storyList; track story) {
                            <div class="form-field">
                                <input type="checkbox" id="story-checkbox-{{story.id}}" [value]="story.id" (change)="onStoryChange($event, story)" [checked]="isStoryInEvent(story.title)" />
                                <button class="linked-story" [routerLink]="['/story', story.id]" type="button">
                                    <label class="secondary-label">{{ story.title }}</label>
                                </button>
                            </div>
                        }
                    </div>
                </div>
                <div class="details-section secondary-section">
                    <label class="primary-label" for="event-characters">Characters</label>
                    <div class="vertical-section">
                        @for(character of characterList; track character) {
                            <div class="form-field">
                                <input type="checkbox" id="character-checkbox-{{character.id}}" [value]="character.id" (change)="onCharacterChange($event, character)" [checked]="isCharacterInEvent(character.firstName + ' ' + character.lastName)" />
                                <button class="linked-character" [routerLink]="['/character', character.id]" type="button">
                                    <label class="secondary-label">{{ character.firstName }} {{ character.lastName }}</label>
                                </button>
                            </div>
                        }
                    </div>
                </div>
            </div>
            
            <div class="details-section primary-section spanning-section">
                <div class="details-section secondary-section">
                    <label class="primary-label" for="event-tags">Tags</label>
                    <textarea class="small-textarea" id="event-tags" formControlName="eventTags" placeholder="Enter tags separated by commas..."></textarea>
                </div>
            </div>
        </section>
        <button type="submit" class="save-button primary">Save</button>
    </form>

    <app-timeline
      [events]="filteredEventList"
      [currentEventId]="worldEvent?.id?.toString()"
      title="Events Timeline"
      noResultsMessage="No events found. Try adjusting your search or add a new event."
      (addElement)="addWorldEvent()"
      (tagClicked)="onTagClicked($event)">
    </app-timeline>
</article>