<article>
    <section class="details-heading horizontal-section">
        <h2 class="location-title">{{ worldLocation?.name }}</h2>
        <button class="delete-button secondary" (click)="deleteLocation()">Delete Location</button>
    </section>
    <form [formGroup]="applyForm" (submit)="submitApplication()">
        <section class="edit-location-form location-page-body">
            <div class="details-section primary-section horizontal-section">
                <div class="details-section secondary-section">
                    <label class="primary-label" for="location-title">Location Title</label>
                    <input id="location-title" type="text" formControlName="locationTitle" placeholder="Enter location name..." />
                </div>
            </div>
            
            <div class="details-section primary-section spanning-section">
                <div class="details-section secondary-section">
                    <label class="primary-label" for="location-description">Location Description</label>
                    <textarea id="location-description" class="medium-textarea" formControlName="locationDescription" placeholder="Describe this location, its appearance, atmosphere, and significance..."></textarea>
                </div>
            </div>
            
            <div class="details-section primary-section horizontal-section">
                <div class="details-section secondary-section">
                    <label class="primary-label" for="location-characters">Location Characters</label>
                    <!-- <input id="location-characters" type="text" formControlName="locationCharacters" /> -->
                    <div class="vertical-section">
                        @for(character of characterList; track character) {
                            <div class="form-field">
                                <input type="checkbox" id="character-checkbox-{{character.id}}" [value]="character.id" (change)="onCharacterChange($event, character)" [checked]="isCharacterInLocation(character.firstName + ' ' + character.lastName)" />
                                <button class="linked-character" [routerLink]="['/character', character.id]" type="button">
                                    <label class="secondary-label">{{ character.firstName }} {{ character.lastName }}</label>
                                </button>
                            </div>
                        }
                    </div>
                </div>
                <div class="details-section secondary-section">
                    <label class="primary-label" for="location-stories">Location Stories</label>
                    <!-- <input id="location-stories" type="text" formControlName="locationStories" /> -->
                    <div class="vertical-section">
                        @for(story of storyList; track story) {
                            <div class="form-field">
                                <input type="checkbox" id="story-checkbox-{{story.id}}" [value]="story.id" (change)="onStoryChange($event, story)" [checked]="isStoryInLocation(story.title)" />
                                <button class="linked-story" [routerLink]="['/story', story.id]" type="button">
                                    <label class="secondary-label">{{ story.title }}</label>
                                </button>
                            </div>
                        }
                    </div>
                </div>
            </div>
            
            <div class="details-section primary-section spanning-section">
                <div class="details-section secondary-section">
                    <label class="primary-label" for="location-related-locations">Related Locations</label>
                    <div class="vertical-section">
                        @for(location of locationList; track location) {
                            @if(worldLocation?.id !== location.id) {
                                <div class="form-field">
                                    <input type="checkbox" id="related-location-checkbox-{{location.id}}" [value]="location.id" (change)="onRelatedLocationChange($event, location)" [checked]="isRelatedLocationInLocation(location.name)" />
                                    <button class="linked-location" [routerLink]="['/location', location.id]" type="button">
                                        <label class="secondary-label">{{ location.name }}</label>
                                    </button>
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>
            
            <div class="details-section primary-section horizontal-section">
                <div class="details-section secondary-section">
                    <label class="primary-label" for="location-tags">Location Tags</label>
                    <textarea class="small-textarea" id="location-tags" formControlName="locationTags" placeholder="Enter tags separated by commas..."></textarea>
                </div>
            </div>
        </section>
        <button type="submit" class="save-button primary">Save</button>
    </form>
</article>